<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cell Type VAF vignette • scDNA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cell Type VAF vignette">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scDNA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Cell_type_VAFs.html">Cell Type VAF vignette</a></li>
    <li><a class="dropdown-item" href="../articles/CNV_example_vignette.html">CopyNumberVariation_tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/Demultiplex_vignette.html">scDNA: Example for demultiplexing samples</a></li>
    <li><a class="dropdown-item" href="../articles/vignette.html">scDNA: R package for DNA+protein single cell DNA sequencing analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cell Type VAF vignette</h1>
                        <h4 data-toc-skip class="author">Bobby Bowman
and Michael Bowman</h4>
            
            <h4 data-toc-skip class="date">2025-12-18</h4>
      

      <div class="d-none name"><code>Cell_type_VAFs.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bowmanr.github.io/scDNA/">scDNA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Homo.sapiens</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">VariantAnnotation</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/GenomicRanges" class="external-link">GenomicRanges</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">TxDb.Hsapiens.UCSC.hg19.knownGene</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BSgenome.Hsapiens.UCSC.hg19</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/niaid/dsb" class="external-link">dsb</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/AnnotationDbi" class="external-link">AnnotationDbi</a></span><span class="op">)</span></span></code></pre></div>
<p>This tutorial will discuss 2 separate ways to conduct cell type VAFs:
1) The first is a variant approach style where cells will be labeled in
bulk to identify clones and cell types will be labeled second 2) the
next is to identify cell types first, and find VAF info mutations
seconds.</p>
<div class="section level2">
<h2 id="variant-first-and-cell-types-second-analysis-">Variant first and cell types second analysis.<a class="anchor" aria-label="anchor" href="#variant-first-and-cell-types-second-analysis-"></a>
</h2>
<p>We will first start with the same file we use in the basic starting
tutorial, and find the 3 main variants of interest following the
standard pipeline.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_file</span><span class="op">&lt;-</span> <span class="st">"../H5/LAMA.dna+protein.h5"</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variant_output</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/variant_ID.html">variant_ID</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">sample_file</span>,</span>
<span>                           panel<span class="op">=</span><span class="st">"MSK_RL"</span>,</span>
<span>                            GT_cutoff<span class="op">=</span><span class="fl">0</span>,</span>
<span>                             VAF_cutoff<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">genes_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IDH2"</span>,<span class="st">"NRAS"</span>,<span class="st">"NPM1"</span>,<span class="st">"TET2"</span>,<span class="st">"FLT3"</span>,<span class="st">"IDH1"</span><span class="op">)</span></span>
<span><span class="va">variants_of_interest</span><span class="op">&lt;-</span><span class="va">variant_output</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Class</span><span class="op">==</span><span class="st">"Exon"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">VAF</span><span class="op">&gt;</span><span class="fl">0.01</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genotyping_rate</span><span class="op">&gt;</span><span class="fl">85</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CONSEQUENCE</span><span class="op">)</span><span class="op">&amp;</span><span class="va">CONSEQUENCE</span><span class="op">!=</span><span class="st">"synonymous"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SYMBOL</span><span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span><span class="va">genes_of_interest</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>   </span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">VAF</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/tapestri_h5_to_sce.html">tapestri_h5_to_sce</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">sample_file</span>,</span>
<span>                      variant_set <span class="op">=</span> <span class="va">variants_of_interest</span>,</span>
<span>                      GT_cutoff<span class="op">=</span><span class="fl">90</span>, </span>
<span>                      VAF_cutoff<span class="op">=</span><span class="fl">0.01</span>,</span>
<span>                      DP_cutoff<span class="op">=</span><span class="fl">10</span>,</span>
<span>                      GQ_cutoff<span class="op">=</span><span class="fl">20</span>,</span>
<span>                      AF_cutoff<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">sce</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/enumerate_clones.html">enumerate_clones</a></span><span class="op">(</span><span class="va">sce</span>, replicates <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">sce</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/compute_clone_statistics.html">compute_clone_statistics</a></span><span class="op">(</span><span class="va">sce</span>,skip_ploidy<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Now we will convert sce to seurat and follow the standard cell type
identification</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">droplet_metadata</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_droplet_size.html">extract_droplet_size</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span>
<span><span class="va">background_droplets</span><span class="op">&lt;-</span><span class="va">droplet_metadata</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Droplet_type</span><span class="op">==</span><span class="st">"Empty"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dna_size</span><span class="op">&lt;</span><span class="fl">1.5</span><span class="op">&amp;</span><span class="va">dna_size</span><span class="op">&gt;</span><span class="fl">0.15</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Cell</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sce_subset</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/normalize_protein_data.html">normalize_protein_data</a></span><span class="op">(</span>sce<span class="op">=</span><span class="va">sce</span>,</span>
<span>                             metadata<span class="op">=</span><span class="va">droplet_metadata</span>,</span>
<span>                             method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dsb"</span>,<span class="st">"CLR"</span><span class="op">)</span>,</span>
<span>                             detect_IgG<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                             background_droplets<span class="op">=</span><span class="va">background_droplets</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/as.Seurat.html" class="external-link">as.Seurat</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span>,counts<span class="op">=</span><span class="st">"Protein"</span>,data<span class="op">=</span><span class="st">"CLR_norm"</span><span class="op">)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu">SeuratObject</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/RenameAssays.html" class="external-link">RenameAssays</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>, originalexp <span class="op">=</span> <span class="st">'Protein'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"TET2"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"NPM1"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"NRAS"</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="va">s</span>, assay <span class="op">=</span> <span class="st">"Protein"</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">s</span>,assay <span class="op">=</span> <span class="st">"Protein"</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span><span class="va">s</span>, features <span class="op">=</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/VariableFeatures.html" class="external-link">VariableFeatures</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>,</span>
<span>                   dims <span class="op">=</span> <span class="cn">NULL</span>,  </span>
<span>                   k.param <span class="op">=</span> <span class="fl">30</span>, <span class="co">#30 nearest cells</span></span>
<span>                   annoy.metric <span class="op">=</span> <span class="st">"cosine"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>, </span>
<span>                  assay <span class="op">=</span> <span class="st">"Protein"</span>,</span>
<span>                  resolution <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>                  algorithm <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html" class="external-link">RunUMAP</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>, </span>
<span>            seed.use <span class="op">=</span> <span class="fl">1990</span>, </span>
<span>            min.dist <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>            n.neighbors <span class="op">=</span> <span class="fl">100</span>, </span>
<span>            features<span class="op">=</span><span class="va">s</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">Protein</span><span class="op">@</span><span class="va">var.features</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="va">marker_differences</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html" class="external-link">FindAllMarkers</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="variant-first-clone-identification">Variant First Clone identification<a class="anchor" aria-label="anchor" href="#variant-first-clone-identification"></a>
</h2>
<p>After labeling cell types we can compare the overlap to our clone
codes. We see a large portion of WT cells at 0_0_0 are Lymphoid.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Idents.html" class="external-link">RenameIdents</a></span><span class="op">(</span><span class="va">s</span>,`0`<span class="op">=</span><span class="st">"HSPC"</span>,`1`<span class="op">=</span><span class="st">"Myeloid Blast"</span>,`2`<span class="op">=</span><span class="st">"Monocytic Blast"</span>,`3`<span class="op">=</span><span class="st">"HSC"</span>,`4`<span class="op">=</span><span class="st">"Mature Monocyte"</span>,`5`<span class="op">=</span><span class="st">"Lymphoid"</span>,`6`<span class="op">=</span><span class="st">"DC"</span>,`7`<span class="op">=</span><span class="st">"Other"</span>,`8`<span class="op">=</span><span class="st">"HSPC"</span>,`9`<span class="op">=</span><span class="st">"Other"</span><span class="op">)</span></span>
<span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">&lt;-</span><span class="va">s</span><span class="op">@</span><span class="va">active.ident</span></span>
<span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">cell_type</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HSC"</span>,<span class="st">"HSPC"</span>,<span class="st">"Myeloid Blast"</span>,</span>
<span>                     <span class="st">"Monocytic Blast"</span>, <span class="st">"Mature Monocyte"</span>,<span class="st">"DC"</span>,</span>
<span>                     <span class="st">"Lymphoid"</span>,<span class="st">"Other"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">s</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>,label <span class="op">=</span> <span class="cn">F</span>,group.by <span class="op">=</span> <span class="st">"cell_type"</span>,cols <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu">kelly</span><span class="op">(</span>n<span class="op">=</span><span class="fl">9</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">)</span><span class="op">&amp;</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">s</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>,label <span class="op">=</span> <span class="cn">F</span>,group.by<span class="op">=</span><span class="st">"Clone"</span><span class="op">)</span></span></code></pre></div>
<p>We can further look at a heatmap to highlight the distribution of
clones along each cell type. The Lymphoid cells are primarily in WT,
while Monocytic cells occupy the 1_0_1 which are TET2 NRAS mutant. The
other myeloid cells are primarily 1_1_0 which is TET2 NPM1 mutant.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pheatmap</span><span class="fu">::</span><span class="fu">pheatmap</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">cell_type</span>,<span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Clone</span><span class="op">)</span>,</span>
<span>                   scale <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>                   color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">11</span>, name <span class="op">=</span> <span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cell-type-first-and-then-finding-specific-vaf-assessment">Cell type first and then finding specific VAF assessment<a class="anchor" aria-label="anchor" href="#cell-type-first-and-then-finding-specific-vaf-assessment"></a>
</h2>
<p>Within our variant_ID function, we can take advantage of the
demultiplexing functionality and treat each cell type as its own sample.
Just be sure to change the cell_type column name to be “final_cluster.”
This will produce a variant table for each cell type.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_data_data_frame_cell_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/FetchData.html" class="external-link">FetchData</a></span><span class="op">(</span><span class="va">s</span>,vars <span class="op">=</span> <span class="st">"cell_type"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_we_want</span><span class="op">&lt;-</span><span class="va">meta_data_data_frame_cell_type</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>final_cluster<span class="op">=</span><span class="st">"cell_type"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var<span class="op">=</span><span class="st">"cell_names"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cell_names</span>,<span class="va">final_cluster</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cell_specific_variant</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/variant_ID.html">variant_ID</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">sample_file</span>,</span>
<span>                           panel<span class="op">=</span><span class="st">"MSK_RL"</span>,</span>
<span>                            GT_cutoff<span class="op">=</span><span class="fl">0</span>,</span>
<span>                            VAF_cutoff<span class="op">=</span><span class="fl">0</span>, </span>
<span>                           demultiplexed <span class="op">=</span> <span class="va">df_we_want</span><span class="op">)</span></span></code></pre></div>
<p>Let’s build an enrichment plot to compare 2 separate cell
populations, monocytic blasts and lymphoid, that should be distinct in
mutational profiling. As some variants may not have been found in either
population, we will first clean these up and assign them as 0 VAF. Let’s
also highlight 3 variants we know exist from the bulk population
NRAS.G12R, TET2.R1516*, NPM1.287. Variants below the dashed line mean
there is an enrichment of lymphoid cells while above it is an enrichment
of monocytic blasts.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cell_specific_variant</span><span class="op">&lt;-</span><span class="va">cell_specific_variant</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`VAF_Lymphoid`<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`VAF_Lymphoid`</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">`VAF_Lymphoid`</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`VAF_Monocytic.Blast`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`VAF_Monocytic.Blast`</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">`VAF_Monocytic.Blast`</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Color_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">final_annot</span><span class="op">==</span><span class="st">"NRAS.G12R"</span><span class="op">~</span><span class="st">"NRAS.G12R"</span>,</span>
<span>    <span class="va">final_annot</span><span class="op">==</span><span class="st">"TET2.R1516*"</span><span class="op">~</span><span class="st">"TET2.R1516*"</span>,</span>
<span>    <span class="va">final_annot</span><span class="op">==</span><span class="st">"NPM1.287"</span><span class="op">~</span><span class="st">"NPM1.287"</span>,</span>
<span>    <span class="cn">TRUE</span><span class="op">~</span><span class="st">"Other"</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Color_group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Color_group</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TET2.R1516*"</span>,<span class="st">"NPM1.287"</span>,<span class="st">"NRAS.G12R"</span>,<span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cell_specific_variant</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">`VAF_Lymphoid`</span>, </span>
<span>             y<span class="op">=</span><span class="va">`VAF_Monocytic.Blast`</span>,</span>
<span>             color<span class="op">=</span><span class="va">Color_group</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>,alpha<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#scale_size_manual(values=c("VAF"=3L))+</span></span>
<span>  <span class="co">#scale_color_manual(values=c("VAF"="#E75B64FF"))+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope<span class="op">=</span><span class="fl">1</span>,intercept <span class="op">=</span> <span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NRAS.G12R"</span> <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Greens"</span>,n<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>,</span>
<span>                              <span class="st">"TET2.R1516*"</span><span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Blues"</span>,n<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>,</span>
<span>                              <span class="st">"NPM1.287"</span> <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Reds"</span>,n<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>,</span>
<span>                     <span class="st">"Other"</span> <span class="op">=</span> <span class="st">"grey70"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu">theme_classic2</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Lymphoid vs. Monocytic Blast"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.line.x<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.line.y<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        plot.title<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="co">#,legend.position = "none")+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"VAF Lymphoid"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"VAF Monocytic Blast"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bobby Bowman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
