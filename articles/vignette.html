<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scDNA">
<title>scDNA: R package for DNA+protein single cell DNA sequencing analysis • scDNA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="scDNA: R package for DNA+protein single cell DNA sequencing analysis">
<meta property="og:description" content="scDNA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scDNA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette.html">scDNA: R package for DNA+protein single cell DNA sequencing analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>scDNA: R package for DNA+protein single cell DNA sequencing analysis</h1>
                        <h4 data-toc-skip class="author">Michael Bowman
and Bobby Bowman</h4>
            
            <h4 data-toc-skip class="date">9/12/2023</h4>
      
      
      <div class="d-none name"><code>vignette.Rmd</code></div>
    </div>

    
    
<p>Install scDNA package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"bowmanr/scDNA"</span><span class="op">)</span></span></code></pre></div>
<p>loading in necessary libraries</p>
<p>Start off by loading the scDNA package, and pointing the system to a
h5 of interest. For speed purposes, I strongly suggest you have the file
local as opposed to on the server. Change the folder path below to the
match where you have placed the Sample1962.dna+protein.h5 file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_file</span><span class="op">&lt;-</span> <span class="st">"~/CodingCamp/Projects/scDNA_demo/Sample1962.dna+protein.h5"</span></span>
<span><span class="co">#sample_file&lt;-c("/Users/bowmanrl/Desktop/Review/MSK24.cells.loom")</span></span></code></pre></div>
<p>First, we read in the h5 file to generate the variant outputs we
seek. This function has 2 forms: 1) an exploratory phase, and a 2)
refinement phase. These two phases are determined by 2 cutoff parameters
in the function. The GT_cutoff is the fraction of cells that are
successfully genotyped for initial filtering. The VAF_cutoff is the
variant allele frequency cutoff and is the fraction of cells that are
mutated for initial filtering of variants (as a percent so a value of 12
means 12%).</p>
<p>To ensure the exploratory phase is used, set the GT_cutoff=0, and
VAF_cutoff=0. This will produce all possible variants that may be of
interest, disregarding quality of the cells. The refinement phase is
used after we have ID-ed variants of interest and allows for quality
control on the cells of expressing those variants. We recommend that to
start with an exploratory phase first before jumping right to the
refinement phase (GT_cutoff=35 and VAF_cutoff=5).</p>
<p>The variant_outputs will tell you the Variant ID, along with the
number of cells that are called wildtype, heterozygous, homozygous, or
we can’t tell and it is labeled as Missing. Along with the
genotyping_rate for the calls.</p>
<p>The variants are annotated from nucleotide positions on the
chromosomes to their standard gene nomenclature, then these are joined
together into a single data frame. Afterwards, you can find the genes
you are interested in. An exmaple of pulling out out 3 genes, and
plotting the Genotyping rate vs the Variant Allele Frequency (VAF) for
all cells. This is an essential transition point from the exploratory
phase to the refinement phase.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#need to install SpareMatrixStats</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/AnnotationDbi" class="external-link">AnnotationDbi</a></span><span class="op">)</span></span>
<span><span class="va">variant_output</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/variant_ID.html">variant_ID</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">sample_file</span>,</span>
<span>                           panel<span class="op">=</span><span class="st">"MSK_RL"</span>,</span>
<span>                            GT_cutoff<span class="op">=</span><span class="fl">0</span>,</span>
<span>                             VAF_cutoff<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">genes_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IDH2"</span>,<span class="st">"NRAS"</span>,<span class="st">"NPM1"</span>,<span class="st">"TET2"</span>,<span class="st">"FLT3"</span>,<span class="st">"IDH1"</span><span class="op">)</span></span></code></pre></div>
<p>Using the above plot can help in determining which variants we should
gain further insight into. As an example, we are looking for
heterozygous mutations (near the 50% VAF), with good quality genotyping
rate. The following is how to filter the table to reduce the table to
variants of interest.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variants_of_interest</span><span class="op">&lt;-</span><span class="va">variant_output</span><span class="op">%&gt;%</span></span>
<span>                        <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Class</span><span class="op">==</span><span class="st">"Exon"</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">VAF</span><span class="op">&gt;</span><span class="fl">0.01</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genotyping_rate</span><span class="op">&gt;</span><span class="fl">85</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CONSEQUENCE</span><span class="op">)</span><span class="op">&amp;</span><span class="va">CONSEQUENCE</span><span class="op">!=</span><span class="st">"synonymous"</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SYMBOL</span><span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span><span class="va">genes_of_interest</span><span class="op">)</span><span class="op">%&gt;%</span>   </span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/MaskCollection-class.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">VAF</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have variants of interest we want to explore further,
more stringent gates are devised to pull out “good” quality cells to
explore. In this case, we increase the genotyping quality (so there are
less Missing counts compared to actually good calls). The other gating
parameters are Depth read (DP_cutoff) which is the minimum number of
reads necessary for a reliable genotype call in a single cell, the
Allele Frequency bandpass filter (AF_cutoff) which is the deviation from
0, 50, or 100% for a reliable call of WT, Het or Hom respectively. The
last gating is the genotyping quality for indiviudal cells (GQ_cutoff)
which is the minimum genotype quality necessary for a reliable genotype
call. Afterwards this is put into a SingleCellExperiment object to
standardize the data format for the rest of our package or to be used by
others such as Suerat or dsb.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="va">sce</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/tapestri_h5_to_sce.html">tapestri_h5_to_sce</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">sample_file</span>,</span>
<span>                      variant_set <span class="op">=</span> <span class="va">variants_of_interest</span>,</span>
<span>                      GT_cutoff<span class="op">=</span><span class="fl">90</span>, </span>
<span>                      VAF_cutoff<span class="op">=</span><span class="fl">0.01</span>,</span>
<span>                      DP_cutoff<span class="op">=</span><span class="fl">10</span>,</span>
<span>                      GQ_cutoff<span class="op">=</span><span class="fl">20</span>,</span>
<span>                      AF_cutoff<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>This produces SingleCellExperiment object. Updates clones in the
metadata for the quality check.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/enumerate_clones.html">enumerate_clones</a></span><span class="op">(</span><span class="va">sce</span>, replicates <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">sce</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/compute_clone_statistics.html">compute_clone_statistics</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span></code></pre></div>
<p>We can now look at a clonograph of the data, select a subset of
clones and plot another clonograph</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clonograph.html">clonograph</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce_subset</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_clones.html">select_clones</a></span><span class="op">(</span><span class="va">sce</span>,</span>
<span>                          ADO_cut<span class="op">=</span><span class="fl">0.10</span>,</span>
<span>                          GQ_cut<span class="op">=</span><span class="fl">30</span>,</span>
<span>                          DP_cut<span class="op">=</span><span class="fl">10</span>,</span>
<span>                          select_exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/clonograph.html">clonograph</a></span><span class="op">(</span><span class="va">sce_subset</span>,complete_only<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>##Reinforcement Learning Trajectory Analysis</p>
<p>After developing the clonograph, there are two routes to for further
analysis: 1) Trajectory Analysis of possible mutation order and cohort
summarization, 2) Protein analysis for cell type identification.</p>
<p>First we will discuss the trajectory analysis, then we will discuss
protein analysis. The following function uses the trajectory_analysis
function which finds a few different trajectories we can explore.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">compiler</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://datastorm-open.github.io/visNetwork/" class="external-link">visNetwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="co">#enableJIT(3) #uncomment this line to speed up the trajectory analysis.</span></span>
<span><span class="va">sce_subset</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/trajectory_analysis.html">trajectory_analysis</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span></span>
<span><span class="va">start_state</span> <span class="op">=</span><span class="st">"0_0_0"</span> <span class="co"># Change based on problem and number of variants we are using</span></span>
<span><span class="va">goal_state</span> <span class="op">=</span> <span class="st">"1_1_1"</span> <span class="co"># Change based on problem and number of varianrs we are using``</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce_subset</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_own_path.html">get_own_path</a></span><span class="op">(</span><span class="va">sce_subset</span>,<span class="va">start_state</span>,<span class="va">goal_state</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/visualize_any_optimal_path.html">visualize_any_optimal_path</a></span><span class="op">(</span><span class="va">sce_subset</span>,<span class="va">start_state</span>,<span class="va">goal_state</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">Trajectories</span><span class="op">$</span><span class="va">WT_to_last_possible_clone</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis_full_net</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/visualize_full_network.html">visualize_full_network</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span></span>
<span><span class="va">vis_full_net</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis_best_WT_to_dominant_clone</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/visualize_WT_dominant_clone.html">visualize_WT_dominant_clone</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span></span>
<span><span class="va">vis_best_WT_to_dominant_clone</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">Trajectories</span><span class="op">$</span><span class="va">WT_to_dominant_clone</span><span class="op">)</span></span></code></pre></div>
<p>All paths from WT to dominant clone:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis_all_WT_to_dominant_clone</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/visualize_all_WT_dominant_clone.html">visualize_all_WT_dominant_clone</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span></span>
<span><span class="va">vis_all_WT_to_dominant_clone</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">Trajectories</span><span class="op">$</span><span class="va">All_WT_to_dominant_clone</span><span class="op">)</span></span></code></pre></div>
<p>given user defined state, find where it can go with the clonograph
this is done by setting observed states variable equal to the ones that
are observed in our dataframe.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">given_state</span> <span class="op">&lt;-</span><span class="st">"0"</span></span>
<span><span class="fu"><a href="../reference/match_clonal_graph.html">match_clonal_graph</a></span><span class="op">(</span><span class="va">sce_subset</span>,<span class="va">given_state</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">Trajectories</span><span class="op">$</span><span class="va">WT_to_Observed_paths</span><span class="op">)</span></span></code></pre></div>
<p>##Protein Now we will demonstrate how to export the protein data to
Seurat for clustering, and producing a UMAP. We also demonstrate our
wrapper to normalize protein data with either CLR (base Seurat) or dsb
if you have IGg controls. Coming soon, our own normalization method for
protein information! Stay tuned!</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/niaid/dsb" class="external-link">dsb</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="va">droplet_metadata</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_droplet_size.html">extract_droplet_size</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Try changing bins=1000 to see overlap empty droplets and real ones</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">droplet_metadata</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">dna_size</span>, y <span class="op">=</span> <span class="va">protein_size</span>,color<span class="op">=</span><span class="va">Droplet_type</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                  <span class="fu">geom_density_2d</span><span class="op">(</span>bins<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">5</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">1.5</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>After obtaining the protein matrix, we now want to extract background
cells and normalize the protein. Both strategies to normalize the data
are shown below.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">background_droplets</span><span class="op">&lt;-</span><span class="va">droplet_metadata</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Droplet_type</span><span class="op">==</span><span class="st">"Empty"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dna_size</span><span class="op">&lt;</span><span class="fl">1.5</span><span class="op">&amp;</span><span class="va">dna_size</span><span class="op">&gt;</span><span class="fl">0.15</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">pull</span><span class="op">(</span><span class="va">Cell</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sce_subset</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/normalize_protein_data.html">normalize_protein_data</a></span><span class="op">(</span>sce<span class="op">=</span><span class="va">sce</span>,</span>
<span>                             metadata<span class="op">=</span><span class="va">droplet_metadata</span>,</span>
<span>                             method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dsb"</span>,<span class="st">"CLR"</span><span class="op">)</span>,</span>
<span>                             detect_IgG<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                             background_droplets<span class="op">=</span><span class="va">background_droplets</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biobase" class="external-link">Biobase</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowViz</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fcs_export.html">fcs_export</a></span><span class="op">(</span><span class="va">sce_subset</span>,</span>
<span>           slot<span class="op">=</span><span class="st">"CLR_norm"</span>,</span>
<span>           save_path<span class="op">=</span><span class="st">"~/Desktop/sample_CLR.fcs"</span><span class="op">)</span></span></code></pre></div>
<p>Now we want to load in our data into Seurat. Keep in mind which
normalization method for protein was used above. Comment out the one you
do not want to use (or let it use CLR as it will currently overwrite the
dsb one). Below follows the standard Seurat implementation where you
apply nearest neighbor search, generate clusters, and build a UMAP.
Afterwards, are some examples of further data exploration and plots to
analyze your results.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/as.Seurat.html" class="external-link">as.Seurat</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce_subset</span><span class="op">)</span>,counts<span class="op">=</span><span class="st">"Protein"</span>,data<span class="op">=</span><span class="st">"CLR_norm"</span><span class="op">)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu">SeuratObject</span><span class="fu">::</span><span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/RenameAssays.html" class="external-link">RenameAssays</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>, originalexp <span class="op">=</span> <span class="st">'Protein'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"TET2"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"NPM1"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"NRAS"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="va">s</span>, assay <span class="op">=</span> <span class="st">"Protein"</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">s</span>,assay <span class="op">=</span> <span class="st">"Protein"</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span><span class="va">s</span>, features <span class="op">=</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/VariableFeatures.html" class="external-link">VariableFeatures</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span><span class="va">s</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span><span class="va">s</span>, resolution <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co"># cluster and run umap (based directly on dsb normalized values without isotype controls)</span></span>
<span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>,</span>
<span>                   dims <span class="op">=</span> <span class="cn">NULL</span>,  </span>
<span>                   k.param <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># direct graph clustering </span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>, </span>
<span>                  assay <span class="op">=</span> <span class="st">"Protein"</span>,</span>
<span>                  resolution <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  algorithm <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># umap for visualization only; (this is optional)</span></span>
<span><span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html" class="external-link">RunUMAP</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">s</span>, </span>
<span>            seed.use <span class="op">=</span> <span class="fl">1990</span>, </span>
<span>            min.dist <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>            n.neighbors <span class="op">=</span> <span class="fl">50</span>, </span>
<span>            features<span class="op">=</span><span class="va">s</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">Protein</span><span class="op">@</span><span class="va">var.features</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">s</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>,group.by <span class="op">=</span><span class="st">"Clone"</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html" class="external-link">FeaturePlot</a></span><span class="op">(</span><span class="va">s</span>,features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD19"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html" class="external-link">Idents</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"Clone"</span></span>
<span><span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/FindMarkers.html" class="external-link">FindMarkers</a></span><span class="op">(</span><span class="va">s</span>,ident.1 <span class="op">=</span> <span class="st">"0_0_0"</span>,ident.2 <span class="op">=</span> <span class="st">"1_1_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/RidgePlot.html" class="external-link">RidgePlot</a></span><span class="op">(</span><span class="va">s</span>,features <span class="op">=</span> <span class="st">"CD3"</span><span class="op">)</span></span></code></pre></div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bobby Bowman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
